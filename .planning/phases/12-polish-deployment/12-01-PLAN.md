---
phase: 12-polish-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - site/package.json
  - site/src/styles/global.css
  - site/src/components/sections/Features.astro
  - site/src/components/sections/Architecture.astro
  - site/src/components/sections/Quickstart.astro
  - site/src/components/sections/UseCases.astro
  - site/src/components/ui/FeatureCard.astro
  - site/src/components/ui/UseCaseCard.astro
  - site/src/layouts/BaseLayout.astro
autonomous: true

must_haves:
  truths:
    - "Feature cards and sections below the fold animate into view when scrolled to (opacity + translateY reveal)"
    - "Cards within Features and UseCases sections stagger their reveal (not all at once)"
    - "Hero section is always visible immediately (no animation, above fold)"
    - "Page has zero cumulative layout shift from animations (only opacity and transform used)"
    - "Users with prefers-reduced-motion see all content immediately without animation"
  artifacts:
    - path: "site/src/styles/global.css"
      provides: "CSS initial hidden state for .reveal-section and .reveal-card classes"
      contains: ".reveal-section"
    - path: "site/src/layouts/BaseLayout.astro"
      provides: "Animation script importing animate, inView, stagger from motion"
      contains: "from \"motion\""
    - path: "site/src/components/sections/Features.astro"
      provides: "reveal-section and reveal-stagger CSS classes on section and grid"
      contains: "reveal-section"
    - path: "site/src/components/ui/FeatureCard.astro"
      provides: "reveal-card CSS class on card root element"
      contains: "reveal-card"
  key_links:
    - from: "site/src/layouts/BaseLayout.astro"
      to: "motion"
      via: "import { animate, inView, stagger } from 'motion'"
      pattern: "import.*from.*motion"
    - from: "site/src/layouts/BaseLayout.astro"
      to: "site/src/styles/global.css"
      via: "CSS selectors .reveal-section, .reveal-card, .reveal-stagger"
      pattern: "\\.reveal-section"
    - from: "site/src/components/sections/Features.astro"
      to: "site/src/layouts/BaseLayout.astro"
      via: "CSS class names matched by animation script selectors"
      pattern: "reveal-stagger"
---

<objective>
Add scroll-triggered reveal animations to all below-fold sections using Motion's vanilla JS API (animate, inView, stagger). Sections fade up into view as the user scrolls, with feature and use case cards staggering their reveal for visual polish.

Purpose: Elevate the landing page from static content to a polished, animated experience that feels professional and engaging.
Output: Motion installed, CSS initial hidden states, reveal classes on sections/cards, animation script in BaseLayout.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-polish-deployment/12-RESEARCH.md
@.planning/phases/11-page-content-components/11-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install motion and add CSS initial hidden states</name>
  <files>
    site/package.json
    site/src/styles/global.css
  </files>
  <action>
1. Install motion in the site/ directory:
   ```bash
   cd site && npm install motion
   ```
   This adds motion 12.34.x to package.json dependencies. Do NOT install any other packages.

2. Add CSS initial hidden states to `site/src/styles/global.css` AFTER the existing `@media (prefers-reduced-motion: reduce)` block. Add these rules:

   ```css
   /* Scroll-triggered animation initial states */
   .reveal-section,
   .reveal-card {
     opacity: 0;
     transform: translateY(30px);
   }

   @media (prefers-reduced-motion: reduce) {
     .reveal-section,
     .reveal-card {
       opacity: 1;
       transform: none;
     }
   }
   ```

   IMPORTANT: Only use `opacity` and `transform` -- these are compositor-only properties that cause zero CLS. Do NOT use `display: none`, `height`, `margin`, or any layout-triggering property.

   The `prefers-reduced-motion` fallback ensures content is visible when the user has reduced motion enabled or when JavaScript fails to load (content defaults to visible).
  </action>
  <verify>
    ```bash
    cd site && npm ls motion && grep -c "reveal-section" src/styles/global.css
    ```
    motion appears in dependency tree. grep returns 2 (one for the rule, one for the reduced-motion override).
  </verify>
  <done>motion is installed in package.json. global.css has .reveal-section and .reveal-card initial hidden states with prefers-reduced-motion fallback.</done>
</task>

<task type="auto">
  <name>Task 2: Add reveal classes to section components and animation script to BaseLayout</name>
  <files>
    site/src/components/sections/Features.astro
    site/src/components/sections/Architecture.astro
    site/src/components/sections/Quickstart.astro
    site/src/components/sections/UseCases.astro
    site/src/components/ui/FeatureCard.astro
    site/src/components/ui/UseCaseCard.astro
    site/src/layouts/BaseLayout.astro
  </files>
  <action>
**Add CSS classes to section components (4 sections + 2 UI components):**

1. **Features.astro** -- Add `reveal-section` to the outer `<section>` element. Add `reveal-stagger` to the grid `<div>` that contains the FeatureCard components:
   - `<section class="reveal-section py-16 md:py-20 ...`
   - `<div class="reveal-stagger grid grid-cols-1 md:grid-cols-2 ...`

2. **Architecture.astro** -- Add `reveal-section` to the outer `<section>` element:
   - `<section class="reveal-section py-16 md:py-20 ...`

3. **Quickstart.astro** -- Add `reveal-section` to the outer `<section>` element. Keep the existing `id="quickstart"` and `scroll-mt-8`:
   - `<section id="quickstart" class="reveal-section scroll-mt-8 py-16 md:py-20 ...`

4. **UseCases.astro** -- Add `reveal-section` to the outer `<section>` element. Add `reveal-stagger` to the grid `<div>` that contains UseCaseCard components:
   - `<section class="reveal-section py-16 md:py-20 ...`
   - `<div class="reveal-stagger grid grid-cols-1 md:grid-cols-2 ...`

5. **FeatureCard.astro** -- Add `reveal-card` to the root `<div>` class list. It already uses `class:list`, so prepend `"reveal-card"` to the array:
   - `class:list={["reveal-card bg-bg-secondary border border-border ...`

6. **UseCaseCard.astro** -- Add `reveal-card` to the root `<div>`:
   - `<div class="reveal-card bg-bg-secondary border border-border ...`

**Do NOT add animation classes to:**
- Hero.astro (above fold, must be visible immediately)
- Footer.astro (simple, always at bottom)
- index.astro (no changes needed)

**Add animation script to BaseLayout.astro:**

Add a `<script>` tag INSIDE the `<body>` element, after the `<slot />`. Use Astro's default processed script (NOT `is:inline`) so Vite tree-shakes and bundles the motion imports:

```astro
<body class="bg-bg-primary text-text-primary font-sans antialiased">
  <slot />
  <script>
    import { animate, inView, stagger } from "motion";

    // Reveal sections with fade-up on scroll
    inView(".reveal-section", (element) => {
      animate(
        element,
        { opacity: [0, 1], y: [30, 0] },
        { duration: 0.6, ease: [0.17, 0.55, 0.55, 1] }
      );
    }, { amount: 0.15 });

    // Stagger reveal cards within their parent container
    inView(".reveal-stagger", ({ target }) => {
      const cards = target.querySelectorAll(".reveal-card");
      if (cards.length > 0) {
        animate(
          cards,
          { opacity: [0, 1], y: [20, 0] },
          { duration: 0.5, ease: [0.17, 0.55, 0.55, 1], delay: stagger(0.1) }
        );
      }
    }, { amount: 0.15 });
  </script>
</body>
```

Key details:
- `amount: 0.15` triggers when 15% of element is visible
- No return value from inView callback = animation plays once, does not reverse on scroll-out
- `y` shorthand maps to translateY (compositor-only, no CLS)
- `ease: [0.17, 0.55, 0.55, 1]` is a smooth deceleration curve
- The script is processed by Astro/Vite, which tree-shakes unused motion exports
- Astro deduplicates scripts automatically -- having it in BaseLayout means it runs exactly once per page
  </action>
  <verify>
    ```bash
    cd site && npm run build 2>&1 | tail -5
    ls -lh dist/_astro/*.js 2>/dev/null
    grep -l "reveal-section" src/components/sections/*.astro | wc -l
    grep -l "reveal-card" src/components/ui/*.astro | wc -l
    ```
    Build succeeds. JS bundle(s) exist in dist/_astro/ and total under 50kb. 4 section files have reveal-section. 2 UI files have reveal-card.
  </verify>
  <done>All 4 below-fold sections have reveal-section class. Features and UseCases grids have reveal-stagger class. FeatureCard and UseCaseCard have reveal-card class. BaseLayout has animation script importing from motion. Build produces JS bundle under 50kb. Hero has no animation classes.</done>
</task>

</tasks>

<verification>
1. `cd site && npm run build` completes without errors
2. `ls -lh dist/_astro/*.js` shows JS file(s) totaling under 50kb (expected ~4-5kb for motion tree-shaken)
3. `grep -c "reveal-section" src/styles/global.css` returns 2 (rule + reduced-motion override)
4. `grep -c "reveal-section" src/components/sections/Features.astro` returns 1
5. `grep -c "reveal-section" src/components/sections/Architecture.astro` returns 1
6. `grep -c "reveal-section" src/components/sections/Quickstart.astro` returns 1
7. `grep -c "reveal-section" src/components/sections/UseCases.astro` returns 1
8. `grep -c "reveal-card" src/components/ui/FeatureCard.astro` returns 1
9. `grep -c "reveal-card" src/components/ui/UseCaseCard.astro` returns 1
10. Hero.astro has NO reveal-section class: `grep -c "reveal-section" src/components/sections/Hero.astro` returns 0
11. `grep "from.*motion" src/layouts/BaseLayout.astro` matches the animation import
</verification>

<success_criteria>
- motion is installed and tree-shakes to under 50kb total JS
- All 4 below-fold sections (Features, Architecture, Quickstart, UseCases) have reveal-section class
- Features and UseCases grids have reveal-stagger class for card staggering
- FeatureCard and UseCaseCard have reveal-card class
- Hero has NO animation classes (always visible above fold)
- CSS initial state hides reveal elements with opacity:0 + translateY(30px)
- prefers-reduced-motion fallback shows all content without animation
- Build succeeds with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish-deployment/12-01-SUMMARY.md`
</output>
