---
phase: 12-polish-deployment
plan: 02
type: execute
wave: 2
depends_on: [12-01]
files_modified:
  - site/src/layouts/BaseLayout.astro
  - site/public/og-image.png
  - site/public/robots.txt
  - site/astro.config.mjs
autonomous: true

must_haves:
  truths:
    - "Sharing the site URL on Twitter/Slack/Discord shows a rich preview with title, description, and 1200x630 preview image"
    - "The page has a canonical URL, Open Graph tags, and Twitter Card meta tags in the HTML head"
    - "A sitemap.xml is generated at build time for SEO"
    - "robots.txt allows all crawlers and references the sitemap"
  artifacts:
    - path: "site/src/layouts/BaseLayout.astro"
      provides: "OG and Twitter Card meta tags in head, canonical URL, favicon links"
      contains: "og:title"
    - path: "site/public/og-image.png"
      provides: "1200x630px OG preview image for social sharing"
    - path: "site/public/robots.txt"
      provides: "Crawler directives and sitemap reference"
      contains: "Sitemap:"
    - path: "site/astro.config.mjs"
      provides: "@astrojs/sitemap integration"
      contains: "sitemap"
  key_links:
    - from: "site/src/layouts/BaseLayout.astro"
      to: "site/public/og-image.png"
      via: "og:image meta tag referencing /og-image.png with Astro.site base"
      pattern: "og:image"
    - from: "site/public/robots.txt"
      to: "sitemap-index.xml"
      via: "Sitemap: directive pointing to generated sitemap"
      pattern: "Sitemap:.*sitemap-index.xml"
    - from: "site/astro.config.mjs"
      to: "@astrojs/sitemap"
      via: "Astro integration import and configuration"
      pattern: "sitemap"
---

<objective>
Add comprehensive SEO and social sharing metadata: Open Graph tags, Twitter Card tags, canonical URL, OG preview image, sitemap generation, and robots.txt. When the site URL is shared on Twitter/Slack/Discord, it displays a rich preview card with title, description, and branded image.

Purpose: Ensure the site is discoverable by search engines and displays rich previews when shared on social platforms.
Output: Updated BaseLayout with full meta tags, static OG image, robots.txt, sitemap integration.
</objective>

<execution_context>
@/Users/patrykattc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrykattc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-polish-deployment/12-RESEARCH.md
@.planning/phases/12-polish-deployment/12-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sitemap integration, OG image, and robots.txt</name>
  <files>
    site/astro.config.mjs
    site/public/og-image.png
    site/public/robots.txt
  </files>
  <action>
1. **Install and configure @astrojs/sitemap:**
   ```bash
   cd site && npx astro add sitemap --yes
   ```
   This automatically adds `@astrojs/sitemap` to package.json and updates astro.config.mjs with the integration. The `site` field is already set to `https://remotekube.patrykgolabek.dev` in astro.config.mjs, which is required for sitemap generation.

   Verify astro.config.mjs looks like this after the command:
   ```javascript
   import { defineConfig } from "astro/config";
   import tailwindcss from "@tailwindcss/vite";
   import sitemap from "@astrojs/sitemap";

   export default defineConfig({
     site: "https://remotekube.patrykgolabek.dev",
     integrations: [sitemap()],
     vite: {
       plugins: [tailwindcss()],
     },
   });
   ```
   If the automated command does not produce this exact structure, manually edit the file to match.

2. **Create OG preview image at `site/public/og-image.png`:**
   Create a 1200x630px dark-themed OG image. Use an SVG-to-PNG approach:

   Create a temporary SVG file, then convert it to PNG. The image should have:
   - Dark background matching the site's bg-primary color (oklch(0.15 0.01 260) which is approximately #1e1e2e)
   - "RemoteKube" as the main title in white, large font
   - "Deploy once, control from anywhere" as the tagline in muted text
   - A subtle Kubernetes/container visual element (hexagon or container icon outline)
   - Overall dimensions exactly 1200x630px
   - File size under 300KB

   Implementation approach: Use a `<script>` with node canvas, or use `npx @vercel/og` if available, or create a minimal SVG and convert with `npx sharp-cli`. The simplest approach is to create an SVG and use the `sharp` npm package (or `npx sharp`) to convert:

   ```bash
   # Create SVG content
   cat > /tmp/og-image.svg << 'SVGEOF'
   <svg width="1200" height="630" xmlns="http://www.w3.org/2000/svg">
     <rect width="1200" height="630" fill="#1a1a2e"/>
     <rect x="0" y="0" width="1200" height="630" fill="url(#grad)" opacity="0.5"/>
     <defs>
       <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
         <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1"/>
         <stop offset="100%" style="stop-color:#16213e;stop-opacity:1"/>
       </linearGradient>
     </defs>
     <!-- Decorative border -->
     <rect x="40" y="40" width="1120" height="550" rx="16" fill="none" stroke="#2a2a4a" stroke-width="1"/>
     <!-- Main title -->
     <text x="600" y="260" text-anchor="middle" fill="#f0f0f5" font-family="system-ui, sans-serif" font-size="72" font-weight="700">RemoteKube</text>
     <!-- Tagline -->
     <text x="600" y="330" text-anchor="middle" fill="#8888aa" font-family="system-ui, sans-serif" font-size="28">Deploy once, control from anywhere</text>
     <!-- Subtitle -->
     <text x="600" y="390" text-anchor="middle" fill="#666688" font-family="system-ui, sans-serif" font-size="22">AI-powered DevOps agent for Kubernetes</text>
     <!-- Decorative K8s-inspired hexagons -->
     <polygon points="150,480 180,465 210,480 210,510 180,525 150,510" fill="none" stroke="#3a3a6a" stroke-width="1.5"/>
     <polygon points="990,480 1020,465 1050,480 1050,510 1020,525 990,510" fill="none" stroke="#3a3a6a" stroke-width="1.5"/>
     <!-- Accent line -->
     <rect x="500" y="430" width="200" height="3" rx="1.5" fill="#4a6cf7" opacity="0.6"/>
   </svg>
   SVGEOF

   # Convert to PNG using sharp
   cd site && npx --yes sharp-cli -i /tmp/og-image.svg -o public/og-image.png --format png
   ```

   If sharp-cli is not available or fails, try alternative approaches:
   - `npx svgexport /tmp/og-image.svg site/public/og-image.png 1200:630`
   - `npx svg2img /tmp/og-image.svg site/public/og-image.png`
   - Write a small Node.js script using sharp: `npm install sharp --save-dev && node -e "const sharp = require('sharp'); sharp('/tmp/og-image.svg').resize(1200, 630).png().toFile('public/og-image.png')"`
   - As last resort, use `rsvg-convert` if available on the system: `rsvg-convert -w 1200 -h 630 /tmp/og-image.svg > site/public/og-image.png`

   Verify the file exists and is under 300KB:
   ```bash
   ls -lh site/public/og-image.png
   file site/public/og-image.png
   ```

3. **Create `site/public/robots.txt`:**
   ```
   User-agent: *
   Allow: /

   Sitemap: https://remotekube.patrykgolabek.dev/sitemap-index.xml
   ```
  </action>
  <verify>
    ```bash
    cd site && grep "sitemap" astro.config.mjs
    ls -lh public/og-image.png
    cat public/robots.txt
    npm run build 2>&1 | tail -5
    ls dist/sitemap-index.xml 2>/dev/null
    ```
    astro.config.mjs references sitemap. og-image.png exists and is under 300KB. robots.txt references sitemap URL. Build succeeds. sitemap-index.xml exists in dist/.
  </verify>
  <done>@astrojs/sitemap integrated in astro.config.mjs. OG image exists at public/og-image.png (1200x630px, under 300KB). robots.txt allows all crawlers and references sitemap URL. Build generates sitemap-index.xml in dist/.</done>
</task>

<task type="auto">
  <name>Task 2: Add Open Graph, Twitter Card, and canonical meta tags to BaseLayout</name>
  <files>
    site/src/layouts/BaseLayout.astro
  </files>
  <action>
Update `site/src/layouts/BaseLayout.astro` to include comprehensive SEO meta tags. The file currently has a basic Props interface with `title` and `description`. Expand it to include `image` prop and add all meta tags.

Replace the ENTIRE file content with:

```astro
---
import "../styles/global.css";

interface Props {
  title: string;
  description?: string;
  image?: string;
}

const {
  title,
  description = "An AI-powered DevOps agent running inside your Kubernetes cluster, accessible from your phone via Claude's Remote Control",
  image = "/og-image.png"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="canonical" href={canonicalURL} />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="/favicon.ico" sizes="32x32" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />

    <!-- Open Graph / Facebook / Slack / Discord -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={imageURL} />
    <meta property="og:site_name" content="RemoteKube" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={imageURL} />
  </head>
  <body class="bg-bg-primary text-text-primary font-sans antialiased">
    <slot />
    <script>
      import { animate, inView, stagger } from "motion";

      // Reveal sections with fade-up on scroll
      inView(".reveal-section", (element) => {
        animate(
          element,
          { opacity: [0, 1], y: [30, 0] },
          { duration: 0.6, ease: [0.17, 0.55, 0.55, 1] }
        );
      }, { amount: 0.15 });

      // Stagger reveal cards within their parent container
      inView(".reveal-stagger", ({ target }) => {
        const cards = target.querySelectorAll(".reveal-card");
        if (cards.length > 0) {
          animate(
            cards,
            { opacity: [0, 1], y: [20, 0] },
            { duration: 0.5, ease: [0.17, 0.55, 0.55, 1], delay: stagger(0.1) }
          );
        }
      }, { amount: 0.15 });
    </script>
  </body>
</html>
```

CRITICAL details:
- OG tags use `property=` attribute (not `name=`). Twitter tags use `name=` attribute. Mixing these causes silent failures.
- `new URL(image, Astro.site)` generates absolute URLs which OG requires. Relative URLs will NOT work for social previews.
- `twitter:card` must be `summary_large_image` for the 1200x630 preview format
- `Astro.site` is already configured as `https://remotekube.patrykgolabek.dev`
- Default description is 120 chars for optimal display across platforms
- The animation `<script>` tag from Plan 01 is preserved in the body (this plan depends on 12-01 being complete)
- Favicon links point to existing files in public/ (favicon.svg and favicon.ico already exist)
- `Astro.generator` adds a meta tag like `<meta name="generator" content="Astro v5.18.0">`

Do NOT modify the `<body>` contents other than preserving what Plan 01 established (slot + script).
  </action>
  <verify>
    ```bash
    cd site && npm run build 2>&1 | tail -5
    grep "og:title" dist/index.html
    grep "twitter:card" dist/index.html
    grep "canonical" dist/index.html
    grep "og:image" dist/index.html | grep "remotekube.patrykgolabek.dev"
    ```
    Build succeeds. dist/index.html contains og:title, twitter:card, canonical URL, and og:image with absolute URL.
  </verify>
  <done>BaseLayout.astro has complete OG tags (type, url, title, description, image, site_name), Twitter Card tags (card, url, title, description, image), canonical URL, favicon links, and generator meta tag. All image URLs are absolute using Astro.site. Build output HTML contains all expected meta tags.</done>
</task>

</tasks>

<verification>
1. `cd site && npm run build` completes without errors
2. `grep "og:title" dist/index.html` shows OG title tag
3. `grep "og:image" dist/index.html` shows absolute URL to og-image.png
4. `grep "twitter:card" dist/index.html` shows `summary_large_image`
5. `grep "canonical" dist/index.html` shows canonical link
6. `ls dist/sitemap-index.xml` confirms sitemap generated
7. `ls -lh dist/og-image.png` confirms OG image copied to build output
8. `cat dist/robots.txt` shows crawler directives with sitemap URL
9. `grep "from.*motion" dist/index.html || ls dist/_astro/*.js` confirms animation script present (may be in external JS file)
</verification>

<success_criteria>
- BaseLayout.astro has og:type, og:url, og:title, og:description, og:image, og:site_name tags
- BaseLayout.astro has twitter:card (summary_large_image), twitter:url, twitter:title, twitter:description, twitter:image tags
- BaseLayout.astro has canonical URL link using Astro.site
- All OG/Twitter image URLs are absolute (https://remotekube.patrykgolabek.dev/og-image.png)
- og-image.png exists in public/ at 1200x630px, under 300KB
- robots.txt exists with Allow: / and Sitemap directive
- @astrojs/sitemap generates sitemap-index.xml at build time
- Build succeeds with no errors
- Animation script from Plan 01 is preserved in BaseLayout
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish-deployment/12-02-SUMMARY.md`
</output>
