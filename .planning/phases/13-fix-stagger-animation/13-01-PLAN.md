---
phase: 13-fix-stagger-animation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [site/src/layouts/BaseLayout.astro]
autonomous: true
requirements: [DESIGN-02]
gap_closure: true

must_haves:
  truths:
    - "All 6 FeatureCards animate into view on scroll (not stuck at opacity 0)"
    - "All 4 UseCaseCards animate into view on scroll (not stuck at opacity 0)"
    - "No TypeError in browser console from the inView stagger callback"
    - "Build passes with no errors"
  artifacts:
    - path: "site/src/layouts/BaseLayout.astro"
      provides: "Corrected inView stagger callback using (element) parameter"
      contains: 'inView(".reveal-stagger", (element)'
  key_links:
    - from: "site/src/layouts/BaseLayout.astro"
      to: ".reveal-stagger containers (Features.astro, UseCases.astro)"
      via: "inView callback receives DOM Element, queries .reveal-card children"
      pattern: 'inView\(".reveal-stagger", \(element\)'
---

<objective>
Fix the stagger animation bug that causes all 10 cards (6 FeatureCards + 4 UseCaseCards) to remain invisible on scroll.

Purpose: The motion library's inView callback passes a DOM Element as its first argument, but line 69 of BaseLayout.astro incorrectly destructures ({ target }) as if receiving an IntersectionObserverEntry. Since DOM Elements have no .target property, target is undefined and querySelectorAll throws a TypeError. This makes all card content invisible to users with standard motion preferences.

Output: A corrected BaseLayout.astro where the stagger inView callback uses (element) instead of ({ target }), matching the correct pattern already used on line 60.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-fix-stagger-animation/13-RESEARCH.md

@site/src/layouts/BaseLayout.astro
</context>

<interfaces>
<!-- The fix target: BaseLayout.astro lines 69-70 -->
<!-- BEFORE (BUGGY): -->
```javascript
inView(".reveal-stagger", ({ target }) => {
  const cards = target.querySelectorAll(".reveal-card");
```

<!-- AFTER (FIXED -- match line 60 pattern): -->
```javascript
inView(".reveal-stagger", (element) => {
  const cards = element.querySelectorAll(".reveal-card");
```

<!-- Line 60 already uses the correct signature for reference: -->
```javascript
inView(".reveal-section", (element) => {
  animate(element, ...);
```
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Fix inView stagger callback signature and verify build</name>
  <files>site/src/layouts/BaseLayout.astro</files>
  <action>
In site/src/layouts/BaseLayout.astro, fix the inView stagger callback on lines 69-70:

1. Change line 69 from `inView(".reveal-stagger", ({ target }) => {` to `inView(".reveal-stagger", (element) => {`
2. Change line 70 from `const cards = target.querySelectorAll(".reveal-card");` to `const cards = element.querySelectorAll(".reveal-card");`

DO NOT modify any other lines. Specifically, DO NOT touch the inView(".reveal-section") callback on line 60 -- it already uses the correct (element) signature.

The rest of the script block (animate call with stagger, options object) remains unchanged.

After editing, run `cd site && npm run build` to verify the build passes with no errors.
  </action>
  <verify>
    <automated>cd /Users/patrykattc/work/git/claude-in-a-box/site && npm run build 2>&1 | tail -5</automated>
  </verify>
  <done>
- BaseLayout.astro line 69 reads `inView(".reveal-stagger", (element) => {`
- BaseLayout.astro line 70 reads `const cards = element.querySelectorAll(".reveal-card");`
- `npm run build` in site/ completes with exit code 0
- No references to `({ target })` remain in the inView callbacks
  </done>
</task>

</tasks>

<verification>
1. Build check: `cd site && npm run build` exits 0
2. Grep check: `grep -n "({ target })" site/src/layouts/BaseLayout.astro` returns no matches (the buggy destructuring is gone)
3. Pattern check: `grep -n "(element)" site/src/layouts/BaseLayout.astro` shows both line 60 and line 69 using the correct signature
</verification>

<success_criteria>
- The inView stagger callback in BaseLayout.astro uses (element) parameter instead of ({ target })
- Build passes with zero errors
- Both inView callbacks (reveal-section and reveal-stagger) now use consistent (element) signatures
- Cards will animate into view on scroll when deployed (no runtime TypeError)
</success_criteria>

<output>
After completion, create `.planning/phases/13-fix-stagger-animation/13-01-SUMMARY.md`
</output>
