---
import "../styles/global.css";

interface Breadcrumb {
  name: string;
  href: string;
}

interface Props {
  title: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  ogType?: string;
  breadcrumbs?: Breadcrumb[];
}

const {
  title,
  description = "RemoteKube is an open-source AI-powered DevOps agent that runs inside your Kubernetes cluster. Manage pods, diagnose incidents, and run kubectl commands remotely from your phone via Claude Code's Remote Control. Supports Helm, KIND, and Docker Compose deployment.",
  image = "/og-image.png",
  noindex = false,
  ogType = "website",
  breadcrumbs,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);
const siteURL = Astro.site?.toString().replace(/\/$/, "") || "https://remotekube.patrykgolabek.dev";

const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": `${siteURL}/#website`,
      "url": siteURL,
      "name": "RemoteKube",
      "description": description,
      "publisher": { "@id": `${siteURL}/#organization` },
      "inLanguage": "en-US",
    },
    {
      "@type": "Organization",
      "@id": `${siteURL}/#organization`,
      "name": "RemoteKube",
      "url": siteURL,
      "logo": {
        "@type": "ImageObject",
        "url": `${siteURL}/logo.svg`,
      },
      "founder": {
        "@type": "Person",
        "name": "Patryk Golabek",
        "url": "https://patrykgolabek.dev",
      },
      "sameAs": [
        "https://github.com/PatrykQuantumNomad/claude-in-a-box",
      ],
    },
    {
      "@type": "SoftwareApplication",
      "@id": `${siteURL}/#software`,
      "name": "RemoteKube",
      "alternateName": "claude-in-a-box",
      "description": description,
      "url": siteURL,
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Kubernetes, Linux, Docker",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD",
      },
      "license": "https://opensource.org/licenses/MIT",
      "codeRepository": "https://github.com/PatrykQuantumNomad/claude-in-a-box",
      "programmingLanguage": ["Shell", "YAML", "Docker"],
      "keywords": "Kubernetes, kubectl, DevOps, Claude Code, AI agent, remote control, MCP, incident response, cluster management, Helm",
      "author": {
        "@type": "Person",
        "name": "Patryk Golabek",
        "url": "https://patrykgolabek.dev",
      },
    },
    {
      "@type": "WebPage",
      "@id": canonicalURL.toString(),
      "url": canonicalURL.toString(),
      "name": title,
      "description": description,
      "isPartOf": { "@id": `${siteURL}/#website` },
      "about": { "@id": `${siteURL}/#software` },
      "inLanguage": "en-US",
      "dateModified": new Date().toISOString().split("T")[0],
    },
    ...(breadcrumbs ? [{
      "@type": "BreadcrumbList",
      "itemListElement": breadcrumbs.map((crumb, i) => ({
        "@type": "ListItem",
        "position": i + 1,
        "name": crumb.name,
        "item": new URL(crumb.href, Astro.site).toString(),
      })),
    }] : []),
  ],
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />
    <link rel="sitemap" type="application/xml" href="/sitemap-index.xml" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="author" content="Patryk Golabek" />
    {noindex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={imageURL} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="RemoteKube - AI-powered Kubernetes management from your phone" />
    <meta property="og:site_name" content="RemoteKube" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={imageURL} />
    <meta name="twitter:image:alt" content="RemoteKube - AI-powered Kubernetes management from your phone" />

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </head>
  <body class="bg-bg-primary text-text-primary font-sans antialiased">
    <slot />
    <script>
      const hasAnimations = document.querySelector('.reveal-section') || document.querySelector('.reveal-stagger') || document.querySelector('.floating-icon');
      if (hasAnimations) {
        const { animate, inView, stagger } = await import("motion");

        if (!window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
          // Reveal sections with fade-up on scroll
          inView(".reveal-section", (element) => {
            animate(
              element,
              { opacity: [0, 1], y: [30, 0] },
              { duration: 0.6, ease: [0.17, 0.55, 0.55, 1] }
            );
          }, { amount: 0.15 });

          // Stagger reveal cards within their parent container
          inView(".reveal-stagger", (element) => {
            const cards = element.querySelectorAll(".reveal-card");
            if (cards.length > 0) {
              animate(
                cards,
                { opacity: [0, 1], y: [20, 0] },
                { duration: 0.5, ease: [0.17, 0.55, 0.55, 1], delay: stagger(0.1) }
              );
            }
          }, { amount: 0.15 });
        }

        // Floating icons parallax on scroll
        const floatingIcons = document.querySelectorAll<HTMLElement>(".floating-icon");
        if (floatingIcons.length > 0 && !window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
          let ticking = false;
          window.addEventListener("scroll", () => {
            if (!ticking) {
              requestAnimationFrame(() => {
                const scrollY = window.scrollY;
                floatingIcons.forEach((icon) => {
                  const speed = parseFloat(icon.style.getPropertyValue("--fi-speed") || "0.3");
                  const rotate = icon.style.getPropertyValue("--fi-rotate") || "0deg";
                  const offset = scrollY * speed * -0.5;
                  icon.style.transform = `rotate(${rotate}) translateY(${offset}px)`;
                });
                ticking = false;
              });
              ticking = true;
            }
          }, { passive: true });
        }
      }
    </script>
  </body>
</html>
